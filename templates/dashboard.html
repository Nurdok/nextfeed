{% extends 'base.html' %}

{% block title %}dashboard{% endblock %}

{% block head-appendix %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/ZeroClipboard.min.js"></script>
{% endblock %}

{% block content %}
	<div style="width:100%;">
		<h4>Your Personalized URL</h4>
        
        <div class="row-fluid">
        
            <!--  The URL -->
            <div class="span8" align="center">
                <div id="next-slug-wrap" class="control-group info" style="width:100%">
            		<input id="next-slug" style="width: 75%; height: 2em; text-align: center" 
            		       type="text" min="50" disabled 
            		       class="login-field active" 
            		       value="http://nextfeed.org/next?subscription={{ user.get_profile.next_slug }}" />
                </div>
                
                <div align="center" style="width: 20%; min-width: 200px;">
            	    <div class="btn btn-large btn-block btn-inverse" id="copy-button" data-clipboard-target="next-slug">Copy to Clipboard</div>
                </div>
            </div>
            
            <br class="visible-phone"/>
            
            <!-- Explanation -->
            <div class="span4">
                <p>
                <strong>You should to copy this URL and bookmark it.</strong><br/>
                Whenever you hit this address, it will immediately redirect you
                to the oldest unread entry in your feeds.<br/>
                Click it again to the next entry, and so on.<br/>
                You'll get the hang of it once you give it a go!
                </p>
            </div>
            
            <!-- Explanation -->
        
        </div>
	</div>
	<br/>
	<br/>
	<hr/>
	<br/>
	<div style="width:100%;">
		<h4>Your Feeds &nbsp;&nbsp;&nbsp;<img id="loading-icon" style="visibility: hidden;" src="{{ STATIC_URL }}images/loading-icon.gif"/></h4>
    <div id="url-form-container" style="width: 100%; vertical-align: middle; text-align: center">
    <!--
        <form>
            <div class="control-group info" style="text-align: center; width:100%;">
        		<input id="feed-url" type="text" min="50" class="login-field active" placeholder="Paste RSS feed here!"></input>
            </div>
    	    <button class="label label-success btn-inverse btn" id="add-feed-button">Add Feed</button>
        </form>
        -->
        <form action="#" method="post">{% csrf_token %}
            {{ form.non_field_errors }}
            <div class="input-append">
              {{ form.link }}
              <input type="submit" id="add-feed-btn" class="btn" type="button" value="Add Feed" />
            </div>
        </form>
    </div>
    
      <table id="feeds" class="table table-condensed table-hover">
            <tbody>
              {% for subscription in subscriptions %}
              <tr>
                <td style="width: 1px; white-space: nowrap;">
                    <div class="btn-group">
                        <button class="btn btn-mini dropdown-toggle" data-toggle="dropdown">Actions <span class="caret"></span></button>
                        <ul class="dropdown-menu">
                          <li><a href="/action/markunread/{{ subscription.feed.id }}">Mark All Unread</a></li>
                          <li><a href="/action/markread/{{ subscription.feed.id }}">Mark All Read</a></li>
                          <li class="divider"></li>
                          <li><a href="/action/delete/{{ subscription.feed.id }}">Delete</a></li>
                        </ul>
                    </div>
                </td>
                <td><span class="badge">{{ subscription.unread_entries_num }}</span>&nbsp;&nbsp;{{ subscription.feed.title }}</td>
              </tr>
            </tbody>
            {% endfor %}
          </table>
            
	</div>
{% endblock %}    

{% block scripts %}
    <script type="text/javascript">
    var clip = new ZeroClipboard(document.getElementById("copy-button"), {
          moviePath: "{{ STATIC_URL }}swf/ZeroClipboard.swf"
        } );
    </script>
    
    <script type="text/javascript">
    $("#add-feed-btn").click(function() {
        $("#loading-icon").css("visibility", "visible")
    })
    </script>
{% endblock %}    
